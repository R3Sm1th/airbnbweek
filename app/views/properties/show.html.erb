<div class="container col-12 col-lg-8">
  <div class="showheader">
    <h1><%= @property.name %></h1>
  </div>
  <div class="showimages">
    <div class="main col-6">
      <%= cl_image_tag @property.photos[0].key, class:"main img" %>
    </div>
    <div class="otherimages col-6">
      <div class="other">
        <%= cl_image_tag @property.photos[1].key, class:"img" %>
      </div>
      <div class="other">
        <%= cl_image_tag @property.photos[2].key, class:"img" %>
      </div>
      <div class="other">
        <%= cl_image_tag @property.photos[3].key, class:"img" %>
      </div>
      <div class="other">
        <%= cl_image_tag @property.photos[4].key, class:"img" %>
      </div>
    </div>
  </div>
  <div class="d-flex">
    <div class="col-6 show-container">
      <div class="d-flex">
        <h4> Hosted by <%= @property.user.first_name %> <%= @property.user.last_name %></h4>
        <%= cl_image_tag @property.user.photo.key, class:"avatar" %>
      </div>
      <h5> Property Description </h5>
        <p><%= @property.description %></p>
      <h5> Property Amenities </h5>
      <div>
        <ul>
          <% @property.amenities.each do |a| %>
          <li><%= a %></li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="col-6 show-container">
      <h5> Property Booking </h5>
      <div class="container">
        <p>£<%= @property.price %> per night</p>
        <%= simple_form_for [@property, @booking] do |f| %>
          <%= f.input :start, class: 'start-date' %>
          <%= f.input :end, class: 'end-date' %>
          <%= f.input :comment %>
          <%= f.button :submit, class: 'btn btn-primary' %>
        <% end %>
        <p> You won't be charged yet </p>
        <div>
          <p>£<%= @property.price %> x <span id="date-diff">0</span></p>
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              const startDateInput = document.querySelector('.start-date');
              const endDateInput = document.querySelector('.end-date');
              const dateDiffElement = document.getElementById('date-diff');

              startDateInput.addEventListener('change', updateDateDiff);
              endDateInput.addEventListener('change', updateDateDiff);

              function updateDateDiff() {
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                const timeDiff = Math.abs(endDate - startDate);
                const dateDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

                dateDiffElement.value = dateDiff;
                } else {
                  dateDiffElement.value = '0';
                }
            });
          </script>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12">
    <% avg = 0 %><% @property.reviews.each do |r| avg += r.rating end %>
    <h4> <i class="fas fa-star"></i> Reviews - <%= @property.reviews.count %> - Average Score <%= (avg / @property.reviews.count).to_f %> </h4>
    <div class="list-group show-container">
        <% @property.reviews.each do |review| %>
          <li class="list-group-item">
            <p><%= name = review.name.nil? ? "Anonomys User" : review.name %> </p>
            <p><%= review.created_at.strftime("%d/%m/%Y") %> </p>
            <small>
              <% count = 0 %>
              <% 5.times do %>
                <% if review.rating > count %>
                  <i class="fas fa-star"></i>
                <% else %>
                  <i class="far fa-star"></i>
                <% end %>
                <% count += 1 %>
              <% end %>
            </small>
            <p><%= review.content %></p>
          </li>
        <% end %>
    </div>
    <div class="show-container">
      <%= simple_form_for [@property, @review] do |f| %>
        <%= f.input :name %>
        <%= f.input :rating, collection: 0..5 %>
        <%= f.input :content %>
        <%= f.button :submit, class: 'btn btn-primary' %>
      <% end %>
    </div>
  </div>
</div>
